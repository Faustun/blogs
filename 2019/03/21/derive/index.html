<!DOCTYPE html><html lang="zh-cn" prefix="og: http://ogp.me/ns#"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title>前端导出excel · SongZhiguo</title><meta name="description" content="前端导出excel - Songzhiguo powered by Hexo"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/blogs/favicon.ico"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><link rel="stylesheet" href="//gosnails.github.io/lib/css/blog/main.css?v=1.0.3"><link rel="stylesheet" href="//gosnails.github.io/lib/css/blog/search.css?v=1.0.3"></head><body class="pupa"><div class="loading-bar"></div><div class="modal fade"></div><header><div class="container"><a href="/blogs/" class="logo"><img src="/blogs/logo.png"></a><span class="span-holder"></span><nav><a href="/blogs/" target="_self"><i class="fa fa-home"></i></a><a href="/blogs/archives/" target="_self"><i class="fa fa-archive"></i></a><a href="/blogs/about/" target="_self"><i class="fa fa-about"></i></a><a href="javascript:void(0);" class="search"><i class="fa fa-search"></i></a></nav></div></header><div class="popup"><div id="site_search"><input type="text" placeholder="find something…" results="0" id="local-search-input"><div id="local-search-result"></div></div><div id="popupClose" class="popup-btn-close fa"></div></div><main><div class="post post"><article itemscope itemtype="http://schema.org/Article" class="hentry"><div class="container"><div class="entry-header"><h1 class="entry-title">前端导出excel</h1><div class="entry-description"><p>纯前端将数据导出excel<br></div><div class="entry-meta"><time itemprop="datePublished" datetime="星期四, 三月 21日 2019, 10:23:12 上午" class="updated">2019年3月21日</time><em class="post-count">11,666 words</em></div></div><div itemprop="articleBody" class="entry-content"></p>
<h4 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">npm <span class="keyword">install</span> <span class="comment">--save file-saver xlsx</span></div><div class="line"></div><div class="line">npm <span class="keyword">install</span> <span class="comment">--save-dev script-loader</span></div></pre></td></tr></table></figure>
<h4 id="引入文件"><a href="#引入文件" class="headerlink" title="引入文件"></a>引入文件</h4><p>在项目中创建一个文件夹（比如vendor，一般是在src目录下创建）并放入Blob.js和Export2Excel.js</p>
<h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">formatJson(filterVal, jsonData) &#123;</div><div class="line">  <span class="keyword">return</span> jsonData.map(<span class="function"><span class="params">v</span> =&gt;</span> filterVal.map(<span class="function"><span class="params">j</span> =&gt;</span> v[j]))</div><div class="line">&#125;,</div><div class="line">export2Excel() &#123;</div><div class="line">  <span class="keyword">this</span>.loading = <span class="literal">true</span></div><div class="line">  printAllTeacher(getUserid()).then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</div><div class="line">    <span class="keyword">this</span>.exportList = response.data</div><div class="line">    <span class="keyword">const</span> arr = []</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.exportList.length; i++) &#123;</div><div class="line">      <span class="keyword">const</span> obj = &#123;&#125;</div><div class="line">      <span class="keyword">const</span> registerTime = <span class="keyword">this</span>.exportList[i].registerTime</div><div class="line">      <span class="keyword">const</span> instructionsTime = <span class="keyword">this</span>.exportList[i].instructionsTime</div><div class="line">      obj.customerName = <span class="keyword">this</span>.exportList[i].customerName</div><div class="line">      obj.teachersName = <span class="keyword">this</span>.exportList[i].teachersName</div><div class="line">      obj.teachersSex = <span class="keyword">this</span>.exportList[i].teachersSex</div><div class="line">      obj.teachersLevel = <span class="keyword">this</span>.exportList[i].teachersLevel</div><div class="line">      obj.teachersPhone = <span class="keyword">this</span>.exportList[i].teachersPhone</div><div class="line">      arr.push(obj)</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">require</span>.ensure([], () =&gt; &#123;</div><div class="line">      <span class="keyword">const</span> &#123; exportJsonToExcel &#125; = <span class="built_in">require</span>(<span class="string">'../vendor/Export2Excel'</span>)</div><div class="line">      <span class="keyword">const</span> tHeader = [<span class="string">'机构'</span>, <span class="string">'姓名'</span>, <span class="string">'性别'</span>, <span class="string">'级别'</span>, <span class="string">'电话'</span>]</div><div class="line">      <span class="keyword">const</span> filterVal = [<span class="string">'customerName'</span>, <span class="string">'teachersName'</span>, <span class="string">'teachersSex'</span>, <span class="string">'teachersLevel'</span>, <span class="string">'teachersPhone'</span>]</div><div class="line">      <span class="keyword">const</span> list = arr</div><div class="line">      <span class="keyword">const</span> data = <span class="keyword">this</span>.formatJson(filterVal, list)</div><div class="line">      exportJsonToExcel(tHeader, data, <span class="string">'客户师资'</span>)</div><div class="line">      <span class="keyword">this</span>.loading = <span class="literal">false</span></div><div class="line">    &#125;)</div><div class="line">  &#125;).catch(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">    <span class="keyword">this</span>.loading = <span class="literal">false</span></div><div class="line">  &#125;)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">require</span>(<span class="string">'script-loader!file-saver'</span>); <span class="comment">//保存文件用</span></div><div class="line"><span class="built_in">require</span>(<span class="string">'script-loader!vendor/Blob'</span>); <span class="comment">//转二进制用</span></div><div class="line"><span class="built_in">require</span>(<span class="string">'script-loader!xlsx/dist/xlsx.core.min'</span>); <span class="comment">//xlsx核心</span></div></pre></td></tr></table></figure>
<p>由于这几个文件不支持import引入，所以我们需要<code>script-loader</code>来将他们挂载到全局环境下</p>
<p>另外还需要配置文件的alias</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</div><div class="line">  resolve: &#123;</div><div class="line">    alias: &#123;</div><div class="line">      vendor: resolve(<span class="string">'src/vendor'</span>)</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="文件"><a href="#文件" class="headerlink" title="文件"></a>文件</h4><h6 id="Blob-js"><a href="#Blob-js" class="headerlink" title="Blob.js"></a>Blob.js</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div><div class="line">342</div><div class="line">343</div><div class="line">344</div><div class="line">345</div><div class="line">346</div><div class="line">347</div><div class="line">348</div><div class="line">349</div><div class="line">350</div><div class="line">351</div><div class="line">352</div><div class="line">353</div><div class="line">354</div><div class="line">355</div><div class="line">356</div><div class="line">357</div><div class="line">358</div><div class="line">359</div><div class="line">360</div><div class="line">361</div><div class="line">362</div><div class="line">363</div><div class="line">364</div><div class="line">365</div><div class="line">366</div><div class="line">367</div><div class="line">368</div><div class="line">369</div><div class="line">370</div><div class="line">371</div><div class="line">372</div><div class="line">373</div><div class="line">374</div><div class="line">375</div><div class="line">376</div><div class="line">377</div><div class="line">378</div><div class="line">379</div><div class="line">380</div><div class="line">381</div><div class="line">382</div><div class="line">383</div><div class="line">384</div><div class="line">385</div><div class="line">386</div><div class="line">387</div><div class="line">388</div><div class="line">389</div><div class="line">390</div><div class="line">391</div><div class="line">392</div><div class="line">393</div><div class="line">394</div><div class="line">395</div><div class="line">396</div><div class="line">397</div><div class="line">398</div><div class="line">399</div><div class="line">400</div><div class="line">401</div><div class="line">402</div><div class="line">403</div><div class="line">404</div><div class="line">405</div><div class="line">406</div><div class="line">407</div><div class="line">408</div><div class="line">409</div><div class="line">410</div><div class="line">411</div><div class="line">412</div><div class="line">413</div><div class="line">414</div><div class="line">415</div><div class="line">416</div><div class="line">417</div><div class="line">418</div><div class="line">419</div><div class="line">420</div><div class="line">421</div><div class="line">422</div><div class="line">423</div><div class="line">424</div><div class="line">425</div><div class="line">426</div><div class="line">427</div><div class="line">428</div><div class="line">429</div><div class="line">430</div><div class="line">431</div><div class="line">432</div><div class="line">433</div><div class="line">434</div><div class="line">435</div><div class="line">436</div><div class="line">437</div><div class="line">438</div><div class="line">439</div><div class="line">440</div><div class="line">441</div><div class="line">442</div><div class="line">443</div><div class="line">444</div><div class="line">445</div><div class="line">446</div><div class="line">447</div><div class="line">448</div><div class="line">449</div><div class="line">450</div><div class="line">451</div><div class="line">452</div><div class="line">453</div><div class="line">454</div><div class="line">455</div><div class="line">456</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* Blob.js</span></div><div class="line"><span class="comment"> * A Blob, File, FileReader &amp; URL implementation.</span></div><div class="line"><span class="comment"> * 2018-08-09</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * By Eli Grey, http://eligrey.com</span></div><div class="line"><span class="comment"> * By Jimmy Wärting, https://github.com/jimmywarting</span></div><div class="line"><span class="comment"> * License: MIT</span></div><div class="line"><span class="comment"> *   See https://github.com/eligrey/Blob.js/blob/master/LICENSE.md</span></div><div class="line"><span class="comment"> */</span></div><div class="line"></div><div class="line">;(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line"></div><div class="line">  <span class="keyword">var</span> global = <span class="keyword">typeof</span> <span class="built_in">window</span> === <span class="string">'object'</span></div><div class="line">      ? <span class="built_in">window</span> : <span class="keyword">typeof</span> self === <span class="string">'object'</span></div><div class="line">      ? self : <span class="keyword">this</span></div><div class="line"></div><div class="line">  <span class="keyword">var</span> BlobBuilder = global.BlobBuilder</div><div class="line">    || global.WebKitBlobBuilder</div><div class="line">    || global.MSBlobBuilder</div><div class="line">    || global.MozBlobBuilder;</div><div class="line"></div><div class="line">  global.URL = global.URL || global.webkitURL || <span class="function"><span class="keyword">function</span>(<span class="params">href, a</span>) </span>&#123;</div><div class="line">  	a = <span class="built_in">document</span>.createElement(<span class="string">'a'</span>)</div><div class="line">  	a.href = href</div><div class="line">  	<span class="keyword">return</span> a</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">var</span> origBlob = global.Blob</div><div class="line">  <span class="keyword">var</span> createObjectURL = URL.createObjectURL</div><div class="line">  <span class="keyword">var</span> revokeObjectURL = URL.revokeObjectURL</div><div class="line">  <span class="keyword">var</span> strTag = global.Symbol &amp;&amp; global.Symbol.toStringTag</div><div class="line">  <span class="keyword">var</span> blobSupported = <span class="literal">false</span></div><div class="line">  <span class="keyword">var</span> blobSupportsArrayBufferView = <span class="literal">false</span></div><div class="line">  <span class="keyword">var</span> arrayBufferSupported = !!global.ArrayBuffer</div><div class="line">  <span class="keyword">var</span> blobBuilderSupported = BlobBuilder</div><div class="line">    &amp;&amp; BlobBuilder.prototype.append</div><div class="line">    &amp;&amp; BlobBuilder.prototype.getBlob;</div><div class="line"></div><div class="line">  <span class="keyword">try</span> &#123;</div><div class="line">    <span class="comment">// Check if Blob constructor is supported</span></div><div class="line">    blobSupported = <span class="keyword">new</span> Blob([<span class="string">'ä'</span>]).size === <span class="number">2</span></div><div class="line"></div><div class="line">    <span class="comment">// Check if Blob constructor supports ArrayBufferViews</span></div><div class="line">    <span class="comment">// Fails in Safari 6, so we need to map to ArrayBuffers there.</span></div><div class="line">    blobSupportsArrayBufferView = <span class="keyword">new</span> Blob([<span class="keyword">new</span> <span class="built_in">Uint8Array</span>([<span class="number">1</span>,<span class="number">2</span>])]).size === <span class="number">2</span></div><div class="line">  &#125; <span class="keyword">catch</span>(e) &#123;&#125;</div><div class="line"></div><div class="line">  <span class="comment">/**</span></div><div class="line"><span class="comment">   * Helper function that maps ArrayBufferViews to ArrayBuffers</span></div><div class="line"><span class="comment">   * Used by BlobBuilder constructor and old browsers that didn't</span></div><div class="line"><span class="comment">   * support it in the Blob constructor.</span></div><div class="line"><span class="comment">   */</span></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">mapArrayBufferViews</span>(<span class="params">ary</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> ary.map(<span class="function"><span class="keyword">function</span>(<span class="params">chunk</span>) </span>&#123;</div><div class="line">      <span class="keyword">if</span> (chunk.buffer <span class="keyword">instanceof</span> <span class="built_in">ArrayBuffer</span>) &#123;</div><div class="line">        <span class="keyword">var</span> buf = chunk.buffer;</div><div class="line"></div><div class="line">        <span class="comment">// if this is a subarray, make a copy so we only</span></div><div class="line">        <span class="comment">// include the subarray region from the underlying buffer</span></div><div class="line">        <span class="keyword">if</span> (chunk.byteLength !== buf.byteLength) &#123;</div><div class="line">          <span class="keyword">var</span> copy = <span class="keyword">new</span> <span class="built_in">Uint8Array</span>(chunk.byteLength);</div><div class="line">          copy.set(<span class="keyword">new</span> <span class="built_in">Uint8Array</span>(buf, chunk.byteOffset, chunk.byteLength));</div><div class="line">          buf = copy.buffer;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">return</span> buf;</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      <span class="keyword">return</span> chunk;</div><div class="line">    &#125;);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">BlobBuilderConstructor</span>(<span class="params">ary, options</span>) </span>&#123;</div><div class="line">    options = options || &#123;&#125;;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> bb = <span class="keyword">new</span> BlobBuilder();</div><div class="line">    mapArrayBufferViews(ary).forEach(<span class="function"><span class="keyword">function</span>(<span class="params">part</span>) </span>&#123;</div><div class="line">      bb.append(part);</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    <span class="keyword">return</span> options.type ? bb.getBlob(options.type) : bb.getBlob();</div><div class="line">  &#125;;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">BlobConstructor</span>(<span class="params">ary, options</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> origBlob(mapArrayBufferViews(ary), options || &#123;&#125;);</div><div class="line">  &#125;;</div><div class="line"></div><div class="line">  <span class="keyword">if</span> (global.Blob) &#123;</div><div class="line">    BlobBuilderConstructor.prototype = Blob.prototype;</div><div class="line">    BlobConstructor.prototype = Blob.prototype;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">FakeBlobBuilder</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">toUTF8Array</span>(<span class="params">str</span>) </span>&#123;</div><div class="line">      <span class="keyword">var</span> utf8 = [];</div><div class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i &lt; str.length; i++) &#123;</div><div class="line">        <span class="keyword">var</span> charcode = str.charCodeAt(i);</div><div class="line">        <span class="keyword">if</span> (charcode &lt; <span class="number">0x80</span>) utf8.push(charcode);</div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (charcode &lt; <span class="number">0x800</span>) &#123;</div><div class="line">          utf8.push(<span class="number">0xc0</span> | (charcode &gt;&gt; <span class="number">6</span>), </div><div class="line">          <span class="number">0x80</span> | (charcode &amp; <span class="number">0x3f</span>));</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (charcode &lt; <span class="number">0xd800</span> || charcode &gt;= <span class="number">0xe000</span>) &#123;</div><div class="line">          utf8.push(<span class="number">0xe0</span> | (charcode &gt;&gt; <span class="number">12</span>), </div><div class="line">          <span class="number">0x80</span> | ((charcode&gt;&gt;<span class="number">6</span>) &amp; <span class="number">0x3f</span>), </div><div class="line">          <span class="number">0x80</span> | (charcode &amp; <span class="number">0x3f</span>));</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// surrogate pair</span></div><div class="line">        <span class="keyword">else</span> &#123;</div><div class="line">          i++;</div><div class="line">          <span class="comment">// UTF-16 encodes 0x10000-0x10FFFF by</span></div><div class="line">          <span class="comment">// subtracting 0x10000 and splitting the</span></div><div class="line">          <span class="comment">// 20 bits of 0x0-0xFFFFF into two halves</span></div><div class="line">          charcode = <span class="number">0x10000</span> + (((charcode &amp; <span class="number">0x3ff</span>)&lt;&lt;<span class="number">10</span>)</div><div class="line">          | (str.charCodeAt(i) &amp; <span class="number">0x3ff</span>));</div><div class="line">          utf8.push(<span class="number">0xf0</span> | (charcode &gt;&gt;<span class="number">18</span>), </div><div class="line">          <span class="number">0x80</span> | ((charcode&gt;&gt;<span class="number">12</span>) &amp; <span class="number">0x3f</span>), </div><div class="line">          <span class="number">0x80</span> | ((charcode&gt;&gt;<span class="number">6</span>) &amp; <span class="number">0x3f</span>), </div><div class="line">          <span class="number">0x80</span> | (charcode &amp; <span class="number">0x3f</span>));</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">      <span class="keyword">return</span> utf8;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">fromUtf8Array</span>(<span class="params">array</span>) </span>&#123;</div><div class="line">      <span class="keyword">var</span> out, i, len, c;</div><div class="line">      <span class="keyword">var</span> char2, char3;</div><div class="line">      </div><div class="line">      out = <span class="string">""</span>;</div><div class="line">      len = array.length;</div><div class="line">      i = <span class="number">0</span>;</div><div class="line">      <span class="keyword">while</span> (i &lt; len) &#123;</div><div class="line">        c = array[i++];</div><div class="line">        <span class="keyword">switch</span> (c &gt;&gt; <span class="number">4</span>)</div><div class="line">        &#123; </div><div class="line">          <span class="keyword">case</span> <span class="number">0</span>: <span class="keyword">case</span> <span class="number">1</span>: <span class="keyword">case</span> <span class="number">2</span>: <span class="keyword">case</span> <span class="number">3</span>: <span class="keyword">case</span> <span class="number">4</span>: <span class="keyword">case</span> <span class="number">5</span>: <span class="keyword">case</span> <span class="number">6</span>: <span class="keyword">case</span> <span class="number">7</span>:</div><div class="line">          <span class="comment">// 0xxxxxxx</span></div><div class="line">          out += <span class="built_in">String</span>.fromCharCode(c);</div><div class="line">          <span class="keyword">break</span>;</div><div class="line">          <span class="keyword">case</span> <span class="number">12</span>: <span class="keyword">case</span> <span class="number">13</span>:</div><div class="line">          <span class="comment">// 110x xxxx   10xx xxxx</span></div><div class="line">          char2 = array[i++];</div><div class="line">          out += <span class="built_in">String</span>.fromCharCode(((c &amp; <span class="number">0x1F</span>) &lt;&lt; <span class="number">6</span>) | (char2 &amp; <span class="number">0x3F</span>));</div><div class="line">          <span class="keyword">break</span>;</div><div class="line">          <span class="keyword">case</span> <span class="number">14</span>:</div><div class="line">          <span class="comment">// 1110 xxxx  10xx xxxx  10xx xxxx</span></div><div class="line">          char2 = array[i++];</div><div class="line">          char3 = array[i++];</div><div class="line">          out += <span class="built_in">String</span>.fromCharCode(((c &amp; <span class="number">0x0F</span>) &lt;&lt; <span class="number">12</span>) |</div><div class="line">          ((char2 &amp; <span class="number">0x3F</span>) &lt;&lt; <span class="number">6</span>) |</div><div class="line">          ((char3 &amp; <span class="number">0x3F</span>) &lt;&lt; <span class="number">0</span>));</div><div class="line">          <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">      &#125;    </div><div class="line">      <span class="keyword">return</span> out;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">isDataView</span>(<span class="params">obj</span>) </span>&#123;</div><div class="line">      <span class="keyword">return</span> obj &amp;&amp; <span class="built_in">DataView</span>.prototype.isPrototypeOf(obj)</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">bufferClone</span>(<span class="params">buf</span>) </span>&#123;</div><div class="line">      <span class="keyword">var</span> view = <span class="keyword">new</span> <span class="built_in">Array</span>(buf.byteLength)</div><div class="line">      <span class="keyword">var</span> array = <span class="keyword">new</span> <span class="built_in">Uint8Array</span>(buf)</div><div class="line">      <span class="keyword">var</span> i = view.length</div><div class="line">      <span class="keyword">while</span>(i--) &#123;</div><div class="line">        view[i] = array[i]</div><div class="line">      &#125;</div><div class="line">      <span class="keyword">return</span> view</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">encodeByteArray</span>(<span class="params">input</span>) </span>&#123;</div><div class="line">      <span class="keyword">var</span> byteToCharMap = <span class="string">'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789'</span></div><div class="line"></div><div class="line">      <span class="keyword">var</span> output = [];</div><div class="line"></div><div class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; input.length; i += <span class="number">3</span>) &#123;</div><div class="line">        <span class="keyword">var</span> byte1 = input[i];</div><div class="line">        <span class="keyword">var</span> haveByte2 = i + <span class="number">1</span> &lt; input.length;</div><div class="line">        <span class="keyword">var</span> byte2 = haveByte2 ? input[i + <span class="number">1</span>] : <span class="number">0</span>;</div><div class="line">        <span class="keyword">var</span> haveByte3 = i + <span class="number">2</span> &lt; input.length;</div><div class="line">        <span class="keyword">var</span> byte3 = haveByte3 ? input[i + <span class="number">2</span>] : <span class="number">0</span>;</div><div class="line"></div><div class="line">        <span class="keyword">var</span> outByte1 = byte1 &gt;&gt; <span class="number">2</span>;</div><div class="line">        <span class="keyword">var</span> outByte2 = ((byte1 &amp; <span class="number">0x03</span>) &lt;&lt; <span class="number">4</span>) | (byte2 &gt;&gt; <span class="number">4</span>);</div><div class="line">        <span class="keyword">var</span> outByte3 = ((byte2 &amp; <span class="number">0x0F</span>) &lt;&lt; <span class="number">2</span>) | (byte3 &gt;&gt; <span class="number">6</span>);</div><div class="line">        <span class="keyword">var</span> outByte4 = byte3 &amp; <span class="number">0x3F</span>;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (!haveByte3) &#123;</div><div class="line">          outByte4 = <span class="number">64</span>;</div><div class="line"></div><div class="line">          <span class="keyword">if</span> (!haveByte2) &#123;</div><div class="line">            outByte3 = <span class="number">64</span>;</div><div class="line">          &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        output.push(</div><div class="line">            byteToCharMap[outByte1], byteToCharMap[outByte2],</div><div class="line">            byteToCharMap[outByte3], byteToCharMap[outByte4])</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      <span class="keyword">return</span> output.join(<span class="string">''</span>)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> create = <span class="built_in">Object</span>.create || <span class="function"><span class="keyword">function</span> (<span class="params">a</span>) </span>&#123;</div><div class="line">      <span class="function"><span class="keyword">function</span> <span class="title">c</span>(<span class="params"></span>) </span>&#123;&#125;</div><div class="line">      c.prototype = a;</div><div class="line">      <span class="keyword">return</span> <span class="keyword">new</span> c</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">if</span> (arrayBufferSupported) &#123;</div><div class="line">      <span class="keyword">var</span> viewClasses = [</div><div class="line">        <span class="string">'[object Int8Array]'</span>,</div><div class="line">        <span class="string">'[object Uint8Array]'</span>,</div><div class="line">        <span class="string">'[object Uint8ClampedArray]'</span>,</div><div class="line">        <span class="string">'[object Int16Array]'</span>,</div><div class="line">        <span class="string">'[object Uint16Array]'</span>,</div><div class="line">        <span class="string">'[object Int32Array]'</span>,</div><div class="line">        <span class="string">'[object Uint32Array]'</span>,</div><div class="line">        <span class="string">'[object Float32Array]'</span>,</div><div class="line">        <span class="string">'[object Float64Array]'</span></div><div class="line">      ]</div><div class="line"></div><div class="line">      <span class="keyword">var</span> isArrayBufferView = <span class="built_in">ArrayBuffer</span>.isView || <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> obj &amp;&amp; viewClasses.indexOf(<span class="built_in">Object</span>.prototype.toString.call(obj)) &gt; <span class="number">-1</span></div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    </div><div class="line">    </div><div class="line">    <span class="comment">/********************************************************/</span></div><div class="line">    <span class="comment">/*                   Blob constructor                   */</span></div><div class="line">    <span class="comment">/********************************************************/</span></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Blob</span>(<span class="params">chunks, opts</span>) </span>&#123;</div><div class="line">      chunks = chunks || []</div><div class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, len = chunks.length; i &lt; len; i++) &#123;</div><div class="line">        <span class="keyword">var</span> chunk = chunks[i]</div><div class="line">        <span class="keyword">if</span> (chunk <span class="keyword">instanceof</span> Blob) &#123;</div><div class="line">          chunks[i] = chunk._buffer</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> chunk === <span class="string">'string'</span>) &#123;</div><div class="line">          chunks[i] = toUTF8Array(chunk)</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (arrayBufferSupported &amp;&amp; (<span class="built_in">ArrayBuffer</span>.prototype.isPrototypeOf(chunk) || isArrayBufferView(chunk))) &#123;</div><div class="line">          chunks[i] = bufferClone(chunk)</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (arrayBufferSupported &amp;&amp; isDataView(chunk)) &#123;</div><div class="line">          chunks[i] = bufferClone(chunk.buffer)</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">          chunks[i] = toUTF8Array(<span class="built_in">String</span>(chunk))</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      <span class="keyword">this</span>._buffer = [].concat.apply([], chunks)</div><div class="line">      <span class="keyword">this</span>.size = <span class="keyword">this</span>._buffer.length</div><div class="line">      <span class="keyword">this</span>.type = opts ? opts.type || <span class="string">''</span> : <span class="string">''</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    Blob.prototype.slice = <span class="function"><span class="keyword">function</span>(<span class="params">start, end, type</span>) </span>&#123;</div><div class="line">      <span class="keyword">var</span> slice = <span class="keyword">this</span>._buffer.slice(start || <span class="number">0</span>, end || <span class="keyword">this</span>._buffer.length)</div><div class="line">      <span class="keyword">return</span> <span class="keyword">new</span> Blob([slice], &#123;<span class="attr">type</span>: type&#125;)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    Blob.prototype.toString = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">      <span class="keyword">return</span> <span class="string">'[object Blob]'</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    </div><div class="line"></div><div class="line">    <span class="comment">/********************************************************/</span></div><div class="line">    <span class="comment">/*                   File constructor                   */</span></div><div class="line">    <span class="comment">/********************************************************/</span></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">File</span>(<span class="params">chunks, name, opts</span>) </span>&#123;</div><div class="line">      opts = opts || &#123;&#125;</div><div class="line">      <span class="keyword">var</span> a = Blob.call(<span class="keyword">this</span>, chunks, opts) || <span class="keyword">this</span></div><div class="line">      a.name = name</div><div class="line">      a.lastModifiedDate = opts.lastModified ? <span class="keyword">new</span> <span class="built_in">Date</span>(opts.lastModified) : <span class="keyword">new</span> <span class="built_in">Date</span></div><div class="line">      a.lastModified = +a.lastModifiedDate</div><div class="line">      </div><div class="line">      <span class="keyword">return</span> a</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    File.prototype = create(Blob.prototype);</div><div class="line">    File.prototype.constructor = File;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (<span class="built_in">Object</span>.setPrototypeOf) </div><div class="line">      <span class="built_in">Object</span>.setPrototypeOf(File, Blob);</div><div class="line">    <span class="keyword">else</span> &#123;</div><div class="line">      <span class="keyword">try</span> &#123;File.__proto__ = Blob&#125; <span class="keyword">catch</span> (e) &#123;&#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    File.prototype.toString = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">      <span class="keyword">return</span> <span class="string">'[object File]'</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    </div><div class="line">    <span class="comment">/********************************************************/</span></div><div class="line">    <span class="comment">/*                FileReader constructor                */</span></div><div class="line">    <span class="comment">/********************************************************/</span></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">FileReader</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    	<span class="keyword">if</span> (!(<span class="keyword">this</span> <span class="keyword">instanceof</span> FileReader))</div><div class="line">    		<span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">"Failed to construct 'FileReader': Please use the 'new' operator, this DOM object constructor cannot be called as a function."</span>)</div><div class="line"></div><div class="line">    	<span class="keyword">var</span> delegate = <span class="built_in">document</span>.createDocumentFragment()</div><div class="line">    	<span class="keyword">this</span>.addEventListener = delegate.addEventListener</div><div class="line">    	<span class="keyword">this</span>.dispatchEvent = <span class="function"><span class="keyword">function</span>(<span class="params">evt</span>) </span>&#123;</div><div class="line">    		<span class="keyword">var</span> local = <span class="keyword">this</span>[<span class="string">'on'</span> + evt.type]</div><div class="line">    		<span class="keyword">if</span> (<span class="keyword">typeof</span> local === <span class="string">'function'</span>) local(evt)</div><div class="line">    		delegate.dispatchEvent(evt)</div><div class="line">    	&#125;</div><div class="line">    	<span class="keyword">this</span>.removeEventListener = delegate.removeEventListener</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">_read</span>(<span class="params">fr, blob, kind</span>) </span>&#123;</div><div class="line">    	<span class="keyword">if</span> (!(blob <span class="keyword">instanceof</span> Blob))</div><div class="line">    		<span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">"Failed to execute '"</span> + kind + <span class="string">"' on 'FileReader': parameter 1 is not of type 'Blob'."</span>)</div><div class="line">    	</div><div class="line">    	fr.result = <span class="string">''</span></div><div class="line"></div><div class="line">    	setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    		<span class="keyword">this</span>.readyState = FileReader.LOADING</div><div class="line">    		fr.dispatchEvent(<span class="keyword">new</span> Event(<span class="string">'load'</span>))</div><div class="line">    		fr.dispatchEvent(<span class="keyword">new</span> Event(<span class="string">'loadend'</span>))</div><div class="line">    	&#125;)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    FileReader.EMPTY = <span class="number">0</span></div><div class="line">    FileReader.LOADING = <span class="number">1</span></div><div class="line">    FileReader.DONE = <span class="number">2</span></div><div class="line">    FileReader.prototype.error = <span class="literal">null</span></div><div class="line">    FileReader.prototype.onabort = <span class="literal">null</span></div><div class="line">    FileReader.prototype.onerror = <span class="literal">null</span></div><div class="line">    FileReader.prototype.onload = <span class="literal">null</span></div><div class="line">    FileReader.prototype.onloadend = <span class="literal">null</span></div><div class="line">    FileReader.prototype.onloadstart = <span class="literal">null</span></div><div class="line">    FileReader.prototype.onprogress = <span class="literal">null</span></div><div class="line"></div><div class="line">    FileReader.prototype.readAsDataURL = <span class="function"><span class="keyword">function</span>(<span class="params">blob</span>) </span>&#123;</div><div class="line">    	_read(<span class="keyword">this</span>, blob, <span class="string">'readAsDataURL'</span>)</div><div class="line">    	<span class="keyword">this</span>.result = <span class="string">'data:'</span> + blob.type + <span class="string">';base64,'</span> + encodeByteArray(blob._buffer)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    FileReader.prototype.readAsText = <span class="function"><span class="keyword">function</span>(<span class="params">blob</span>) </span>&#123;</div><div class="line">    	_read(<span class="keyword">this</span>, blob, <span class="string">'readAsText'</span>)</div><div class="line">    	<span class="keyword">this</span>.result = fromUtf8Array(blob._buffer)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    FileReader.prototype.readAsArrayBuffer = <span class="function"><span class="keyword">function</span>(<span class="params">blob</span>) </span>&#123;</div><div class="line">    	_read(<span class="keyword">this</span>, blob, <span class="string">'readAsText'</span>)</div><div class="line">    	<span class="keyword">this</span>.result = blob._buffer.slice()</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    FileReader.prototype.abort = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;</div><div class="line"></div><div class="line">    </div><div class="line">    <span class="comment">/********************************************************/</span></div><div class="line">    <span class="comment">/*                         URL                          */</span></div><div class="line">    <span class="comment">/********************************************************/</span></div><div class="line">    URL.createObjectURL = <span class="function"><span class="keyword">function</span>(<span class="params">blob</span>) </span>&#123;</div><div class="line">      <span class="keyword">return</span> blob <span class="keyword">instanceof</span> Blob </div><div class="line">        ? <span class="string">'data:'</span> + blob.type + <span class="string">';base64,'</span> + encodeByteArray(blob._buffer)</div><div class="line">        : createObjectURL.call(URL, blob)</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    URL.revokeObjectURL = <span class="function"><span class="keyword">function</span>(<span class="params">url</span>) </span>&#123;</div><div class="line">      revokeObjectURL &amp;&amp; revokeObjectURL.call(URL, url)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/********************************************************/</span></div><div class="line">    <span class="comment">/*                         XHR                          */</span></div><div class="line">    <span class="comment">/********************************************************/</span></div><div class="line">    <span class="keyword">var</span> _send = global.XMLHttpRequest &amp;&amp; global.XMLHttpRequest.prototype.send</div><div class="line">    <span class="keyword">if</span> (_send) &#123;</div><div class="line">      XMLHttpRequest.prototype.send = <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span> (data <span class="keyword">instanceof</span> Blob) &#123;</div><div class="line">          <span class="keyword">this</span>.setRequestHeader(<span class="string">'Content-Type'</span>, data.type)</div><div class="line">          _send.call(<span class="keyword">this</span>, fromUtf8Array(data._buffer))</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">          _send.call(<span class="keyword">this</span>, data)</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    global.FileReader = FileReader</div><div class="line">    global.File = File</div><div class="line">    global.Blob = Blob</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">if</span> (strTag) &#123;</div><div class="line">    File.prototype[strTag] = <span class="string">'File'</span></div><div class="line">    Blob.prototype[strTag] = <span class="string">'Blob'</span></div><div class="line">    FileReader.prototype[strTag] = <span class="string">'FileReader'</span></div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">fixFileAndXHR</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> isIE = !!global.ActiveXObject || (</div><div class="line">      <span class="string">'-ms-scroll-limit'</span> <span class="keyword">in</span> <span class="built_in">document</span>.documentElement.style &amp;&amp; </div><div class="line">      <span class="string">'-ms-ime-align'</span> <span class="keyword">in</span> <span class="built_in">document</span>.documentElement.style</div><div class="line">    )</div><div class="line"></div><div class="line">    <span class="comment">// Monkey patched </span></div><div class="line">    <span class="comment">// IE don't set Content-Type header on XHR whose body is a typed Blob</span></div><div class="line">    <span class="comment">// https://developer.microsoft.com/en-us/microsoft-edge/platform/issues/6047383</span></div><div class="line">    <span class="keyword">var</span> _send = global.XMLHttpRequest &amp;&amp; global.XMLHttpRequest.prototype.send</div><div class="line">    <span class="keyword">if</span> (isIE &amp;&amp; _send) &#123;</div><div class="line">      XMLHttpRequest.prototype.send = <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span> (data <span class="keyword">instanceof</span> Blob) &#123;</div><div class="line">          <span class="keyword">this</span>.setRequestHeader(<span class="string">'Content-Type'</span>, data.type)</div><div class="line">          _send.call(<span class="keyword">this</span>, data)</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">          _send.call(<span class="keyword">this</span>, data)</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">      <span class="keyword">new</span> File([], <span class="string">''</span>)</div><div class="line">    &#125; <span class="keyword">catch</span>(e) &#123;</div><div class="line">      <span class="keyword">try</span> &#123;</div><div class="line">        <span class="keyword">var</span> klass = <span class="keyword">new</span> <span class="built_in">Function</span>(<span class="string">'class File extends Blob &#123;'</span> + </div><div class="line">          <span class="string">'constructor(chunks, name, opts) &#123;'</span> +</div><div class="line">            <span class="string">'opts = opts || &#123;&#125;;'</span> +</div><div class="line">            <span class="string">'super(chunks, opts || &#123;&#125;);'</span> +</div><div class="line">            <span class="string">'this.name = name;'</span> +</div><div class="line">            <span class="string">'this.lastModifiedDate = opts.lastModified ? new Date(opts.lastModified) : new Date;'</span> +</div><div class="line">            <span class="string">'this.lastModified = +this.lastModifiedDate;'</span> +</div><div class="line">          <span class="string">'&#125;&#125;;'</span> +</div><div class="line">          <span class="string">'return new File([], ""), File'</span></div><div class="line">        )()</div><div class="line">        global.File = klass</div><div class="line">      &#125; <span class="keyword">catch</span>(e) &#123;</div><div class="line">        <span class="keyword">var</span> klass = <span class="function"><span class="keyword">function</span>(<span class="params">b, d, c</span>) </span>&#123;</div><div class="line">          <span class="keyword">var</span> blob = <span class="keyword">new</span> Blob(b, c)</div><div class="line">          <span class="keyword">var</span> t = c &amp;&amp; <span class="keyword">void</span> <span class="number">0</span> !== c.lastModified ? <span class="keyword">new</span> <span class="built_in">Date</span>(c.lastModified) : <span class="keyword">new</span> <span class="built_in">Date</span></div><div class="line">          </div><div class="line">          blob.name = d</div><div class="line">          blob.lastModifiedDate = t</div><div class="line">          blob.lastModified = +t</div><div class="line">          blob.toString = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">return</span> <span class="string">'[object File]'</span></div><div class="line">          &#125;</div><div class="line">          </div><div class="line">          <span class="keyword">if</span> (strTag)</div><div class="line">            blob[strTag] = <span class="string">'File'</span></div><div class="line">          </div><div class="line">          <span class="keyword">return</span> blob</div><div class="line">        &#125;</div><div class="line">        global.File = klass</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">if</span> (blobSupported) &#123;</div><div class="line">    fixFileAndXHR()</div><div class="line">    global.Blob = blobSupportsArrayBufferView ? global.Blob : BlobConstructor</div><div class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (blobBuilderSupported) &#123;</div><div class="line">    fixFileAndXHR()</div><div class="line">    global.Blob = BlobBuilderConstructor;</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    FakeBlobBuilder()</div><div class="line">  &#125;</div><div class="line"></div><div class="line">&#125;)();</div></pre></td></tr></table></figure>
<h6 id="export2Excel-js"><a href="#export2Excel-js" class="headerlink" title="export2Excel.js"></a>export2Excel.js</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* eslint-disable */</span></div><div class="line"><span class="built_in">require</span>(<span class="string">'script-loader!file-saver'</span>);</div><div class="line"><span class="built_in">require</span>(<span class="string">'script-loader!vendor/Blob'</span>);</div><div class="line"><span class="built_in">require</span>(<span class="string">'script-loader!xlsx/dist/xlsx.core.min'</span>);</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">generateArray</span>(<span class="params">table</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> out = [];</div><div class="line">    <span class="keyword">var</span> rows = table.querySelectorAll(<span class="string">'tr'</span>);</div><div class="line">    <span class="keyword">var</span> ranges = [];</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> R = <span class="number">0</span>; R &lt; rows.length; ++R) &#123;</div><div class="line">        <span class="keyword">var</span> outRow = [];</div><div class="line">        <span class="keyword">var</span> row = rows[R];</div><div class="line">        <span class="keyword">var</span> columns = row.querySelectorAll(<span class="string">'td'</span>);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> C = <span class="number">0</span>; C &lt; columns.length; ++C) &#123;</div><div class="line">            <span class="keyword">var</span> cell = columns[C];</div><div class="line">            <span class="keyword">var</span> colspan = cell.getAttribute(<span class="string">'colspan'</span>);</div><div class="line">            <span class="keyword">var</span> rowspan = cell.getAttribute(<span class="string">'rowspan'</span>);</div><div class="line">            <span class="keyword">var</span> cellValue = cell.innerText;</div><div class="line">            <span class="keyword">if</span> (cellValue !== <span class="string">""</span> &amp;&amp; cellValue == +cellValue) cellValue = +cellValue;</div><div class="line"></div><div class="line">            <span class="comment">//Skip ranges</span></div><div class="line">            ranges.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">range</span>) </span>&#123;</div><div class="line">                <span class="keyword">if</span> (R &gt;= range.s.r &amp;&amp; R &lt;= range.e.r &amp;&amp; outRow.length &gt;= range.s.c &amp;&amp; outRow.length &lt;= range.e.c) &#123;</div><div class="line">                    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt;= range.e.c - range.s.c; ++i) outRow.push(<span class="literal">null</span>);</div><div class="line">                &#125;</div><div class="line">            &#125;);</div><div class="line"></div><div class="line">            <span class="comment">//Handle Row Span</span></div><div class="line">            <span class="keyword">if</span> (rowspan || colspan) &#123;</div><div class="line">                rowspan = rowspan || <span class="number">1</span>;</div><div class="line">                colspan = colspan || <span class="number">1</span>;</div><div class="line">                ranges.push(&#123;<span class="attr">s</span>: &#123;<span class="attr">r</span>: R, <span class="attr">c</span>: outRow.length&#125;, <span class="attr">e</span>: &#123;<span class="attr">r</span>: R + rowspan - <span class="number">1</span>, <span class="attr">c</span>: outRow.length + colspan - <span class="number">1</span>&#125;&#125;);</div><div class="line">            &#125;</div><div class="line">            ;</div><div class="line"></div><div class="line">            <span class="comment">//Handle Value</span></div><div class="line">            outRow.push(cellValue !== <span class="string">""</span> ? cellValue : <span class="literal">null</span>);</div><div class="line"></div><div class="line">            <span class="comment">//Handle Colspan</span></div><div class="line">            <span class="keyword">if</span> (colspan) <span class="keyword">for</span> (<span class="keyword">var</span> k = <span class="number">0</span>; k &lt; colspan - <span class="number">1</span>; ++k) outRow.push(<span class="literal">null</span>);</div><div class="line">        &#125;</div><div class="line">        out.push(outRow);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> [out, ranges];</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">datenum</span>(<span class="params">v, date1904</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span> (date1904) v += <span class="number">1462</span>;</div><div class="line">    <span class="keyword">var</span> epoch = <span class="built_in">Date</span>.parse(v);</div><div class="line">    <span class="keyword">return</span> (epoch - <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="built_in">Date</span>.UTC(<span class="number">1899</span>, <span class="number">11</span>, <span class="number">30</span>))) / (<span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">1000</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">sheet_from_array_of_arrays</span>(<span class="params">data, opts</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> ws = &#123;&#125;;</div><div class="line">    <span class="keyword">var</span> range = &#123;<span class="attr">s</span>: &#123;<span class="attr">c</span>: <span class="number">10000000</span>, <span class="attr">r</span>: <span class="number">10000000</span>&#125;, <span class="attr">e</span>: &#123;<span class="attr">c</span>: <span class="number">0</span>, <span class="attr">r</span>: <span class="number">0</span>&#125;&#125;;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> R = <span class="number">0</span>; R != data.length; ++R) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> C = <span class="number">0</span>; C != data[R].length; ++C) &#123;</div><div class="line">            <span class="keyword">if</span> (range.s.r &gt; R) range.s.r = R;</div><div class="line">            <span class="keyword">if</span> (range.s.c &gt; C) range.s.c = C;</div><div class="line">            <span class="keyword">if</span> (range.e.r &lt; R) range.e.r = R;</div><div class="line">            <span class="keyword">if</span> (range.e.c &lt; C) range.e.c = C;</div><div class="line">            <span class="keyword">var</span> cell = &#123;<span class="attr">v</span>: data[R][C]&#125;;</div><div class="line">            <span class="keyword">if</span> (cell.v == <span class="literal">null</span>) <span class="keyword">continue</span>;</div><div class="line">            <span class="keyword">var</span> cell_ref = XLSX.utils.encode_cell(&#123;<span class="attr">c</span>: C, <span class="attr">r</span>: R&#125;);</div><div class="line"></div><div class="line">            <span class="keyword">if</span> (<span class="keyword">typeof</span> cell.v === <span class="string">'number'</span>) cell.t = <span class="string">'n'</span>;</div><div class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> cell.v === <span class="string">'boolean'</span>) cell.t = <span class="string">'b'</span>;</div><div class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (cell.v <span class="keyword">instanceof</span> <span class="built_in">Date</span>) &#123;</div><div class="line">                cell.t = <span class="string">'n'</span>;</div><div class="line">                cell.z = XLSX.SSF._table[<span class="number">14</span>];</div><div class="line">                cell.v = datenum(cell.v);</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">else</span> cell.t = <span class="string">'s'</span>;</div><div class="line"></div><div class="line">            ws[cell_ref] = cell;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (range.s.c &lt; <span class="number">10000000</span>) ws[<span class="string">'!ref'</span>] = XLSX.utils.encode_range(range);</div><div class="line">    <span class="keyword">return</span> ws;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Workbook</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span> (!(<span class="keyword">this</span> <span class="keyword">instanceof</span> Workbook)) <span class="keyword">return</span> <span class="keyword">new</span> Workbook();</div><div class="line">    <span class="keyword">this</span>.SheetNames = [];</div><div class="line">    <span class="keyword">this</span>.Sheets = &#123;&#125;;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">s2ab</span>(<span class="params">s</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> buf = <span class="keyword">new</span> <span class="built_in">ArrayBuffer</span>(s.length);</div><div class="line">    <span class="keyword">var</span> view = <span class="keyword">new</span> <span class="built_in">Uint8Array</span>(buf);</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i != s.length; ++i) view[i] = s.charCodeAt(i) &amp; <span class="number">0xFF</span>;</div><div class="line">    <span class="keyword">return</span> buf;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">export_table_to_excel</span>(<span class="params">id</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> theTable = <span class="built_in">document</span>.getElementById(id);</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'a'</span>)</div><div class="line">    <span class="keyword">var</span> oo = generateArray(theTable);</div><div class="line">    <span class="keyword">var</span> ranges = oo[<span class="number">1</span>];</div><div class="line"></div><div class="line">    <span class="comment">/* original data */</span></div><div class="line">    <span class="keyword">var</span> data = oo[<span class="number">0</span>];</div><div class="line">    <span class="keyword">var</span> ws_name = <span class="string">"SheetJS"</span>;</div><div class="line">    <span class="built_in">console</span>.log(data);</div><div class="line"></div><div class="line">    <span class="keyword">var</span> wb = <span class="keyword">new</span> Workbook(), ws = sheet_from_array_of_arrays(data);</div><div class="line"></div><div class="line">    <span class="comment">/* add ranges to worksheet */</span></div><div class="line">    <span class="comment">// ws['!cols'] = ['apple', 'banan'];</span></div><div class="line">    ws[<span class="string">'!merges'</span>] = ranges;</div><div class="line"></div><div class="line">    <span class="comment">/* add worksheet to workbook */</span></div><div class="line">    wb.SheetNames.push(ws_name);</div><div class="line">    wb.Sheets[ws_name] = ws;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> wbout = XLSX.write(wb, &#123;<span class="attr">bookType</span>: <span class="string">'xlsx'</span>, <span class="attr">bookSST</span>: <span class="literal">false</span>, <span class="attr">type</span>: <span class="string">'binary'</span>&#125;);</div><div class="line"></div><div class="line">    saveAs(<span class="keyword">new</span> Blob([s2ab(wbout)], &#123;<span class="attr">type</span>: <span class="string">"application/octet-stream"</span>&#125;), <span class="string">"test.xlsx"</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">formatJson</span>(<span class="params">jsonData</span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(jsonData)</div><div class="line">&#125;</div><div class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">exportJsonToExcel</span>(<span class="params">th, jsonData, defaultTitle</span>) </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">/* original data */</span></div><div class="line"></div><div class="line">    <span class="keyword">var</span> data = jsonData;</div><div class="line">    data.unshift(th);</div><div class="line">    <span class="keyword">var</span> ws_name = <span class="string">"SheetJS"</span>;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> wb = <span class="keyword">new</span> Workbook(), ws = sheet_from_array_of_arrays(data);</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">/* add worksheet to workbook */</span></div><div class="line">    wb.SheetNames.push(ws_name);</div><div class="line">    wb.Sheets[ws_name] = ws;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> wbout = XLSX.write(wb, &#123;<span class="attr">bookType</span>: <span class="string">'xlsx'</span>, <span class="attr">bookSST</span>: <span class="literal">false</span>, <span class="attr">type</span>: <span class="string">'binary'</span>&#125;);</div><div class="line">    <span class="keyword">var</span> title = defaultTitle || <span class="string">'列表'</span></div><div class="line">    saveAs(<span class="keyword">new</span> Blob([s2ab(wbout)], &#123;<span class="attr">type</span>: <span class="string">"application/octet-stream"</span>&#125;), title + <span class="string">".xlsx"</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure></div><div class="entry-extra"><div class="entry-tags"></div></div></div></article></div></main><footer><div class="copyright container"><p>© Copyright 2019 by <a href="https://songzhiguo.github.io/blogs">Songzhiguo powered by Hexo</a>.</p></div></footer><script async src="//cdn.bootcss.com/mathjax/2.7.0-beta.0/MathJax.js"></script><script src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><script async src="//raw.githack.com/Easyfood/pageAccelerator/master/dist/page-accelerator.min.js"></script><script src="/blogs/script/search.js"></script><script async src="/blogs/script/loading.js"></script><script async src="/blogs/script/photo.js"></script></body></html>